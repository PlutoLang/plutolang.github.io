"use strict";(self.webpackChunkpluto=self.webpackChunkpluto||[]).push([[686],{1918:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var i=n(4848),s=n(8453);const o={sidebar_position:3},r=void 0,l={id:"Runtime Environment/HTTP",title:"HTTP",description:"Must be included via require.",source:"@site/docs/Runtime Environment/HTTP.md",sourceDirName:"Runtime Environment",slug:"/Runtime Environment/HTTP",permalink:"/docs/Runtime Environment/HTTP",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Exception",permalink:"/docs/Runtime Environment/Exception"},next:{title:"JSON",permalink:"/docs/Runtime Environment/JSON"}},a={},d=[{value:"<code>http.request</code>",id:"httprequest",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Options",id:"options",level:4},{value:"Returns",id:"returns",level:4},{value:"Multitasking",id:"multitasking",level:4},{value:"Try It Yourself",id:"try-it-yourself",level:4},{value:"<code>http.hasconnection</code>",id:"httphasconnection",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"Multitasking",id:"multitasking-1",level:4},{value:"<code>http.closeconnections</code>",id:"httpcloseconnections",level:3},{value:"Multitasking",id:"multitasking-2",level:4}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Must be included via ",(0,i.jsx)(t.code,{children:"require"}),"."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"httprequest",children:(0,i.jsx)(t.code,{children:"http.request"})}),"\n",(0,i.jsx)(t.p,{children:"Performs an HTTP request."}),"\n",(0,i.jsx)(t.h4,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:'The URL to send a request to as a string. This parameter is optional in the sense that the options table (parameter 2) can be parameter 1 instead, but must have the "url" option then.'}),"\n",(0,i.jsx)(t.li,{children:"The table of options. This parameter is optional if a URL was given."}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"options",children:"Options"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"method:"})," The HTTP request method to use. Defaults to GET."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"headers:"})," A table of headers, e.g. ",(0,i.jsx)(t.code,{children:'{ ["Content-Type"] = "application/json" }'}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"body:"})," An optional request payload. If provided, the ",(0,i.jsx)(t.code,{children:"Content-Length"})," header is set appropriately, and the method is set to POST unless otherwise specified."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"prefer_ipv6:"})," (Does nothing in WASM builds of Pluto.) When establishing a new connection, we attempt to lookup and connect via IPv4, retrying with IPv6 if needed. If this is set to true, we instead start with IPv6. This should not be needed for 99% of use cases."]}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"returns",children:"Returns"}),"\n",(0,i.jsx)(t.p,{children:"On success:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"The response body as a string."}),"\n",(0,i.jsx)(t.li,{children:"The status code as an integer."}),"\n",(0,i.jsx)(t.li,{children:"A table of response headers. Empty in WASM builds of Pluto."}),"\n",(0,i.jsx)(t.li,{children:"The status text as a string."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"On failure:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Nil."}),"\n",(0,i.jsx)(t.li,{children:"An approximate failure reason as an English string. Not available in WASM builds of Pluto."}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"multitasking",children:"Multitasking"}),"\n",(0,i.jsx)(t.p,{children:"If called inside of a coroutine, this function yields. Otherwise, it blocks. In WASM builds of Pluto, it must be called inside of a coroutine that yields to the environment as otherwise the request cannot be dispatched."}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"The first request to a remote may take a while \u2014 especially with HTTPS \u2014 due to the TCP and TLS handshakes. We use keep-alive to keep the connection open, so subsequent requests to the same remote will be significantly faster."})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-pluto",children:'local http = require "pluto:http"\r\nlocal body, status_code, headers, status_text = http.request("https://httpbin.org/anything")\r\nprint(status_code.." "..status_text)\r\nif os.platform != "wasm" then\r\n    print(dumpvar(headers))\r\nend\r\nprint(body)\n'})}),"\n",(0,i.jsx)(t.h4,{id:"try-it-yourself",children:(0,i.jsx)(t.a,{href:"https://pluto-lang.org/web/#code=local%20http%20%3D%20require%20%22pluto%3Ahttp%22%0D%0Alocal%20body%2C%20status_code%2C%20headers%2C%20status_text%20%3D%20http.request(%22https%3A%2F%2Fhttpbin.org%2Fanything%22)%0D%0Aprint(status_code..%22%20%22..status_text)%0D%0Aif%20os.platform%20!%3D%20%22wasm%22%20then%0D%0A%20%20%20%20print(dumpvar(headers))%0D%0Aend%0D%0Aprint(body)",children:"Try It Yourself"})}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"httphasconnection",children:(0,i.jsx)(t.code,{children:"http.hasconnection"})}),"\n",(0,i.jsx)(t.p,{children:"Queries if a keep-alive connection is available for a remote. This function is not available in WASM builds of Pluto."}),"\n",(0,i.jsx)(t.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"A partial URL identifying the remote. Partial because only the protocol, host, and port are used; additional components such as path are ignored."}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"multitasking-1",children:"Multitasking"}),"\n",(0,i.jsx)(t.p,{children:"If called inside of a coroutine, this function may yield. Otherwise, it may block."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-pluto",children:'local { http, scheduler } = require "*"\r\n\r\nlocal sched = new scheduler()\r\nsched:addloop(function()\r\n    print(http.hasconnection("https://httpbin.org"))\r\nend)\r\nsched:add(function()\r\n    print((http.request("https://httpbin.org/anything")))\r\nend)\r\nsched:run()\n'})}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"httpcloseconnections",children:(0,i.jsx)(t.code,{children:"http.closeconnections"})}),"\n",(0,i.jsx)(t.p,{children:"Closes all keep-alive connections like when closing the Lua state but in a non-blocking way. This function does nothing in WASM builds of Pluto."}),"\n",(0,i.jsx)(t.h4,{id:"multitasking-2",children:"Multitasking"}),"\n",(0,i.jsx)(t.p,{children:"This function must be called inside of a coroutine, as it will yield."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var i=n(6540);const s={},o=i.createContext(s);function r(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);